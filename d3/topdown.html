<!DOCTYPE html>
<meta charset="utf-8">
<style>

.chart rect {
  fill: gray;
}

.chart text {
  fill: black;
  font: 18px sans-serif;
  text-anchor: end;
}

</style>

<button>opacity</button>
<svg class="chart"></svg>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

var datameer = [{},
            {},
            {},
            {labelOne: 'BMW', labelTwo: '128HP', class: "label-above", position: 'top'},
            {},
            {},
            {},
            {},
            {},
            {},
            {},
            {},
            {labelOne: 'Mercedes Benz', labelTwo: '168HP', class: "label-above"},
            {},
            {labelOne: 'Audi A5', labelTwo: '202HP', class: "label-above", position: 'top'}]

var width = 1000,
    barHeight = 250,
    barDistance = 50;


// TODO: use the linear scale to make distance
// var x = d3.scale.linear()
//     .domain([0, d3.max(data)])
//     .range([0, width]);

// selection
var chart = d3.select(".chart")
    .attr("width", "100%")
    .attr("height", 800)

// attach the data

// create rectangles for each piece of data
function drawTopDown(data) {

  var bar = chart.selectAll("g")
      .data(data)
      // and create groups spaced
      .enter().append("g")
            .attr("transform", function(d, i) { return "translate(" + barDistance * i + ", 100)" })
            .style('opacity', 0.1);

  bar.append("rect")
      .attr("width", 3)
      .attr("height", barHeight)

  // attach text labels to each group
  // d.labelOne is the top label, based on the y height attribute
  bar.append("text")
      .attr("y", barHeight + 20)
      .attr("dy", ".35em")
      .attr("class", function(d) { return d.class })
      .text( function(d) { return d.labelOne });

  bar.append("text")
      .attr("y", barHeight + 35)
      .attr("dy", ".35em")
      .attr("class", function(d) { return d.class })
      .text( function(d) { return d.labelTwo });

  // loop thru and move up or down conditionally
  var labels = chart.selectAll("text")
  labels.each(labelsPosition)

  function labelsPosition(d, i) {
    if( d.position === 'top') {
      d3.select(this)
        .attr("transform", "translate( 0, -" + (barHeight + 60) + ")")
    }
  }

  var opacityFadeStagger = function() {
    bar.each(opacityFadeCallback)
  }
  // callback function for d3.selection.each iterator
  function opacityFadeCallback(d, i) {
    d3.select(this).transition()
      .style('opacity', 1)
      .duration(500)
      .delay(200 * i)
  }

  button = document.querySelector('button')
  button.addEventListener('click', opacityFadeStagger)
}

drawTopDown(datameer);

</script>
